<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.7.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1645272976866-1" author="dimitris (generated)">
        <createTable tableName="account">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_ACCOUNT"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="calculated_balance" type="DECIMAL"/>
            <column name="last_transaction" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-2" author="dimitris (generated)">
        <createTable tableName="account_user">
            <column name="account_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_ACCOUNT_USER"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_ACCOUNT_USER"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-3" author="dimitris (generated)">
        <createTable tableName="client_user">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_CLIENT_USER"/>
            </column>
            <column name="u_name" type="VARCHAR(255)"/>
            <column name="salt" type="VARCHAR(255)"/>
            <column name="pass" type="VARCHAR(255)"/>
            <column name="f_name" type="VARCHAR(255)"/>
            <column name="s_name" type="VARCHAR(255)"/>
            <column name="comments" type="VARCHAR(255)"/>
            <column name="super_admin" type="BOOLEAN"/>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-4" author="dimitris (generated)">
        <createTable tableName="permission">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_PERMISSION"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-5" author="dimitris (generated)">
        <createTable tableName="token">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_TOKEN"/>
            </column>
            <column name="token" type="VARCHAR(255)"/>
            <column name="user_name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-6" author="dimitris (generated)">
        <createTable tableName="transaction">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_TRANSACTION"/>
            </column>
            <column name="amount" type="DECIMAL"/>
            <column name="date" type="DATETIME"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="type" type="INT"/>
            <column name="user_id" type="BIGINT"/>
            <column name="account_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-7" author="dimitris (generated)">
        <createTable tableName="user_permission">
            <column name="fk_permission" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_USER_PERMISSION"/>
            </column>
            <column name="fk_user" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_USER_PERMISSION"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1645272976866-8" author="dimitris (generated)">
        <addForeignKeyConstraint baseColumnNames="account_id" baseTableName="account_user"
                                 constraintName="FK_ACCUSE_ON_ACCOUNT" referencedColumnNames="id"
                                 referencedTableName="account"/>
    </changeSet>
    <changeSet id="1645272976866-9" author="dimitris (generated)">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="account_user"
                                 constraintName="FK_ACCUSE_ON_USER" referencedColumnNames="id"
                                 referencedTableName="client_user"/>
    </changeSet>
    <changeSet id="1645272976866-10" author="dimitris (generated)">
        <addForeignKeyConstraint baseColumnNames="account_id" baseTableName="transaction"
                                 constraintName="FK_TRANSACTION_ON_ACCOUNT" referencedColumnNames="id"
                                 referencedTableName="account"/>
    </changeSet>
    <changeSet id="1645272976866-11" author="dimitris (generated)">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="transaction"
                                 constraintName="FK_TRANSACTION_ON_USER" referencedColumnNames="id"
                                 referencedTableName="client_user"/>
    </changeSet>
    <changeSet id="1645272976866-12" author="dimitris (generated)">
        <addForeignKeyConstraint baseColumnNames="fk_permission" baseTableName="user_permission"
                                 constraintName="FK_USEPER_ON_PERMISSION" referencedColumnNames="id"
                                 referencedTableName="permission"/>
    </changeSet>
    <changeSet id="1645272976866-13" author="dimitris (generated)">
        <addForeignKeyConstraint baseColumnNames="fk_user" baseTableName="user_permission"
                                 constraintName="FK_USEPER_ON_USER" referencedColumnNames="id"
                                 referencedTableName="client_user"/>
    </changeSet>

    <changeSet id="1645272976866-14" author="dimitris ">
        <sql>
            INSERT INTO CLIENT_USER (ID, COMMENTS, F_NAME, PASS, S_NAME, SALT, SUPER_ADMIN, U_NAME)
            VALUES (1, '', 'admin', 'def1de41e3e48eff838277272a8f0e5bf9ad6d5807a0905afb76e40490d9da2c', 'admin',
                    'QB5Y2AU', true, 'admin');
            INSERT INTO CLIENT_USER (ID, COMMENTS, F_NAME, PASS, S_NAME, SALT, SUPER_ADMIN, U_NAME)
            VALUES (2, '', 'user_1', 'fb0350ddffca2e6fb1dce0ad47fb99bf42305b549d3389948ed360e5ae607365', 'user_1',
                    'IYXN2LC', false, 'user1');
            INSERT INTO CLIENT_USER (ID, COMMENTS, F_NAME, PASS, S_NAME, SALT, SUPER_ADMIN, U_NAME)
            VALUES (3, '', 'user_2', 'b26a106c549574886938f62b4ca22beb8a76f0fe6d36a65703fd7981e8071d2b', 'user_2',
                    'PGR4AJD', false, 'user2');

            INSERT INTO ACCOUNT (ID, DESCRIPTION, CALCULATED_BALANCE, LAST_TRANSACTION)
            VALUES (1, 'Account 1 Savings', null, null);
            INSERT INTO ACCOUNT (ID, DESCRIPTION, CALCULATED_BALANCE, LAST_TRANSACTION)
            VALUES (2, 'Account 2 Payroll', null, null);

            INSERT INTO ACCOUNT_USER (USER_ID, ACCOUNT_ID)
            VALUES (2, 1);
            INSERT INTO ACCOUNT_USER (USER_ID, ACCOUNT_ID)
            VALUES (3, 1);
            INSERT INTO ACCOUNT_USER (USER_ID, ACCOUNT_ID)
            VALUES (2, 2);

            INSERT INTO TRANSACTION (ID, AMOUNT, DATE, DESCRIPTION, TYPE, USER_ID, ACCOUNT_ID)
            VALUES (1, 50, '2022-02-19 14:21:44.634000', 'first saving user1', 1, 2, 1);
            INSERT INTO TRANSACTION (ID, AMOUNT, DATE, DESCRIPTION, TYPE, USER_ID, ACCOUNT_ID)
            VALUES (2, 50, '2022-02-19 14:22:44.634000', 'first saving user2', 1, 3, 1);
            INSERT INTO TRANSACTION (ID, AMOUNT, DATE, DESCRIPTION, TYPE, USER_ID, ACCOUNT_ID)
            VALUES (3, 50, '2022-02-18 14:22:44.634000', 'payroll user1', 1, 2, 2);
        </sql>
    </changeSet>

</databaseChangeLog>
